import pandas as pd
from sklearn.feature_selection import SelectKBest, chi2
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
import os
import time

start_time = time.time()
# Get data from dataset
#os.chdir("../Windows Malware Detection")
os.chdir("Data")
dataset = pd.read_csv("API_Functions.csv")


X = dataset.drop(columns=["SHA256","Type"])
y = dataset["Type"]

selector = SelectKBest(score_func=chi2, k=500)
X_selected = selector.fit_transform(X, y)

# Get selected feature metrics
filtered_features_metrics = selector.get_support(indices=True)
filtered_features = X.columns[filtered_features_metrics]

print("Filtered Features:")
for feature in filtered_features:
    print(feature)
elapsed_time = time.time() - start_time

print(f"Time taken: {elapsed_time:.2f} seconds")

filtered_dataset = dataset[filtered_features]
filtered_dataset = pd.concat([dataset[['SHA256','Type']], filtered_dataset], axis=1)

new_csv_path = "Filtered_API_Functions.csv"
filtered_dataset.to_csv(new_csv_path, index=False)
