import csv,os
from API_Extraction import *
import pandas as pd

# Extract list of the data checked in the dataset
def checked_data():
    os.chdir("Datasets")
    print(os.getcwd())
    with open('API_Functions.csv') as csvFile:
        reader = csv.reader(csvFile,dialect='excel')
        field_names_list = next(reader)
        field_names_list = list(field_names_list)
        del field_names_list[0:2]

    return field_names_list 

# compare the data and creating a dict of the function name and 0 or 1 if the function is used like in the dataset  
def compare_to_data(exe,pe_functions,imported_functions):
    pe_functions_lower = [pefunction.casefold() for pefunction in pe_functions]
    for function in imported_functions:
        if function.casefold() in pe_functions_lower:
            exe[1][function] = 1
        else:
            exe[1][function] = 0
    
    return exe

if __name__ == "__main__":
    pe_file_path = "C:\\Users\\USER\\Documents\\Audacity\\audacity.exe"
    name = "audacity.exe"
    api_functions = dict()
    exe = [name,api_functions]
    pe_functions,mangled_imports = get_imported_functions(pe_file_path)
    imported_functions = checked_data()
    compare_to_data(exe,pe_functions,imported_functions)

